<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Westeros Chronicles</title>
  <meta name="description" content="Westeros Chronicles – a collaborative A Song of Ice and Fire fanfiction hub" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- Snow container -->
  <div class="snow-container"></div>

  <!-- Domain Warning -->
  <div id="domainWarning" class="domain-warning"></div>

  <!-- Global Status Toast -->
  <div id="globalStatus" class="status-message"></div>

  <!-- Header -->
  <header class="site-header">
    <div class="site-title-block">
      <h1 class="site-title">Westeros Chronicles</h1>
      <p class="site-tagline">A shared chronicle of the Seven Kingdoms and beyond</p>
    </div>
    <div class="site-header-right">
      <div id="userStatus" class="user-status"></div>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab-target="storiesTab" type="button">Stories</button>
    <button class="tab-btn" data-tab-target="submitTab" type="button">Submit Chapter</button>
    <button class="tab-btn" data-tab-target="realmTab" type="button">Realm Map</button>
    <button class="tab-btn" data-tab-target="profileTab" type="button">My Profile</button>
    <button class="tab-btn" data-tab-target="ravensTab" type="button">Ravens</button>
  </nav>

  <main class="main-content">
    <!-- STORIES TAB -->
    <section id="storiesTab" class="tab-pane">
      <header class="tab-header">
        <h2>Stories of Ice and Fire</h2>
        <div class="tab-controls">
          <input 
            type="text" 
            id="storySearchInput" 
            class="field field-sm" 
            placeholder="Search stories..."
          />
          <select id="regionFilter" class="field field-sm">
            <option value="all">All Regions</option>
          </select>
          <select id="storySort" class="field field-sm">
            <option value="latest">Latest</option>
            <option value="top">Top Rated</option>
            <option value="oldest">Oldest</option>
          </select>
        </div>
      </header>
      <div id="storiesList" class="stories-list"></div>
    </section>

    <!-- SUBMIT TAB -->
    <section id="submitTab" class="tab-pane">
      <header class="tab-header">
        <h2>Submit a New Chapter</h2>
      </header>
      
      <div id="parentStoryLabel" class="parent-story-label">
        Starting a new, original tale.
      </div>

      <form id="storyForm" class="story-form">
        <label class="field-label" for="storyTitle">Chapter Title</label>
        <input type="text" id="storyTitle" class="field" placeholder="The Wolf and the Lion" required />

        <label class="field-label" for="storyRegion">Region</label>
        <select id="storyRegion" class="field" required>
          <option value="">Select a region</option>
        </select>

        <label class="field-label" for="storyContent">Your Tale</label>
        <textarea 
          id="storyContent" 
          class="field" 
          rows="12" 
          placeholder="Write your chapter in the style of Westeros..."
          required
        ></textarea>

        <button type="submit" class="btn btn-primary">Submit Chapter</button>
      </form>
    </section>

    <!-- REALM MAP TAB -->
    <section id="realmTab" class="tab-pane">
      <header class="tab-header">
        <h2>The Realm</h2>
        <p class="muted">Explore chapters by region</p>
      </header>
      <div id="realmRegionsContainer" class="realm-grid"></div>
    </section>

    <!-- PROFILE TAB -->
    <section id="profileTab" class="tab-pane">
      <header class="tab-header">
        <h2>My Profile</h2>
      </header>

      <div id="profileCard" class="profile-card"></div>

      <section class="profile-settings">
        <h3>Bio</h3>
        <textarea 
          id="profileBio" 
          class="field" 
          rows="4" 
          placeholder="A short tale of who you are..."
        ></textarea>
        <button id="saveProfileBtn" class="btn btn-primary" type="button">Save Profile</button>
        <p id="profileStatus" class="muted"></p>

        <h3>Appearance</h3>
        <label class="toggle">
          <input type="checkbox" id="toggleSnow" />
          <span class="toggle-slider"></span>
          <span class="toggle-label">Enable snowfall</span>
        </label>

        <div class="settings-row">
          <button id="logoutBtn" class="btn btn-danger" type="button">Log Out</button>
        </div>
      </section>

      <section class="profile-stats-section">
        <h3>Stats</h3>
        <div id="profileStats" class="stats-grid"></div>

        <h3>Achievements</h3>
        <div id="profileAchievements" class="achievements-list"></div>
      </section>
    </section>

    <!-- RAVENS TAB -->
    <section id="ravensTab" class="tab-pane">
      <header class="tab-header">
        <h2>Ravens</h2>
        <p class="muted">Send messages to other users by their username</p>
      </header>

      <form id="ravenForm" class="raven-form">
        <label class="field-label" for="ravenTo">Send to</label>
        <input 
          type="text" 
          id="ravenTo" 
          class="field" 
          placeholder="Username (e.g. JonSnow)"
          required 
        />

        <label class="field-label" for="ravenBody">Message</label>
        <textarea 
          id="ravenBody" 
          class="field" 
          rows="4" 
          placeholder="Your message..."
          required
        ></textarea>

        <button type="submit" class="btn btn-primary">Send Raven</button>
      </form>

      <div class="ravens-layout">
        <div class="raven-column">
          <h3>Inbox</h3>
          <ul id="ravenInbox" class="raven-list"></ul>
          <p id="emptyInbox" class="empty-state">No ravens yet.</p>
        </div>

        <div class="raven-column">
          <h3>Sent</h3>
          <ul id="ravenSent" class="raven-list"></ul>
          <p id="emptySent" class="empty-state">No sent ravens yet.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- STORY MODAL -->
  <div id="storyModal" class="modal">
    <div class="modal-content">
      <button id="storyModalClose" class="modal-close" type="button">&times;</button>
      
      <div id="storyModalContent">
        <h2 id="modalStoryTitle"></h2>
        <div id="modalStoryMeta" class="story-meta"></div>
        <div id="modalBranchInfo" class="branch-info"></div>
        <div id="modalStoryBody" class="story-body"></div>
        
        <div class="modal-footer">
          <div class="vote-section">
            <button id="modalVoteUp" class="vote-btn vote-up">▲</button>
            <span id="modalStoryScore" class="vote-score">0</span>
            <button id="modalVoteDown" class="vote-btn vote-down">▼</button>
          </div>
          <button id="modalReplyBtn" class="btn btn-primary">Branch a new tale</button>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <p>Fan project inspired by <em>A Song of Ice and Fire</em>. Not affiliated with George R.R. Martin or HBO.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/auth.js"></script>
  <script src="js/app.js"></script>
</body>
</html>